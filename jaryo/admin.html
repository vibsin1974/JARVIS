<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JARVIS Reference Room - Admin</title>
    <link rel="stylesheet" href="reference.css">
</head>
<body class="reference-body">

    <div class="admin-container">
        <h2>자료실 관리자</h2>
        <div class="header-links">
            <a href="reference.html">사용자 페이지 보기 ></a>
        </div>

        <div class="form-group">
            <h3>새 파일 등록</h3>
            <form id="fileForm">
                <div class="form-group">
                    <label>카테고리</label>
                    <select id="category" required></select>
                </div>
                <div class="form-group">
                    <label>프로그램명</label>
                    <input type="text" id="name" required placeholder="예: 폴라리스 오피스">
                </div>
                <div class="form-group">
                    <label>버전</label>
                    <input type="text" id="version" required placeholder="예: v7.1.292">
                </div>
                <div class="form-group">
                    <label>다운로드 수</label>
                    <input type="number" id="downloads" required value="0">
                </div>
                <div class="form-group">
                    <label>평점 (0.0 - 5.0)</label>
                    <input type="number" id="rating" step="0.1" min="0" max="5" required value="4.0">
                </div>
                <div class="form-group">
                    <label>라이선스</label>
                    <select id="license">
                        <option value="프리">프리</option>
                        <option value="셰어">셰어</option>
                        <option value="유료">유료</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>아이콘 URL</label>
                    <input type="text" id="icon" value="https://placehold.co/40x40/333/fff?text=ICON">
                </div>
                <button type="submit" class="btn">등록</button>
            </form>
        </div>

        <hr>

        <h3>등록된 파일 목록</h3>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>이름</th>
                    <th>카테고리</th>
                    <th>관리</th>
                </tr>
            </thead>
            <tbody id="fileList"></tbody>
        </table>
    </div>

    <script src="data.js"></script>
    <script>
        const categorySelect = document.getElementById('category');
        const fileList = document.getElementById('fileList');
        const form = document.getElementById('fileForm');

        function renderCategories() {
            const categories = DataManager.getCategories();
            categorySelect.innerHTML = categories
                .filter(c => c.id !== 'all')
                .map(c => `<option value="${c.id}">${c.name}</option>`)
                .join('');
        }

        function renderFiles() {
            const files = DataManager.getFiles();
            const categories = DataManager.getCategories();
            
            fileList.innerHTML = files.map(file => {
                const catName = categories.find(c => c.id === file.category)?.name || file.category;
                return `
                    <tr>
                        <td>${file.id}</td>
                        <td>${file.name} (${file.version})</td>
                        <td>${catName}</td>
                        <td>
                            <button onclick="deleteFile(${file.id})" style="background:red; color:white; border:none; padding:5px;">삭제</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function deleteFile(id) {
            if(confirm('정말 삭제하시겠습니까?')) {
                DataManager.deleteFile(id);
                renderFiles();
            }
        }

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const newFile = {
                name: document.getElementById('name').value,
                version: document.getElementById('version').value,
                category: document.getElementById('category').value,
                downloads: parseInt(document.getElementById('downloads').value),
                rating: parseFloat(document.getElementById('rating').value),
                license: document.getElementById('license').value,
                icon: document.getElementById('icon').value,
                isHot: true // Default to hot for now
            };
            DataManager.saveFile(newFile);
            form.reset();
            renderFiles();
            alert('등록되었습니다.');
        });

        // Init
        renderCategories();
        renderFiles();
    </script>
</body>
</html>
